<section>
    <h2>Naufrage dans le Cloud</h2>
</section>
<section>
    <h3>Création du serveur</h3>
    <p>Dans le Cloud, il n'y a pas <em>que</em> un serveur à créer</p>
    <ul>
        <li class="fragment">Un réseau VPC</li>
        <li class="fragment">Un sous-réseau</li>
        <li class="fragment">Les règles de pare-feu</li>
        <li class="fragment">Une instance de machine virtuelle avec un disque persistant</li>
        <li class="fragment">Une IP publique</li>
        <li class="fragment">Les entrées DNS api*.les-sagas-mp3.fr et app*.les-sagas-mp3.fr</li>
        <li class="fragment">Un bucket de stockage de fichiers</li>
    </ul>
</section>
<section>
    <h3>Comment on procède ?</h3>
    <p>Pour chacun de ces éléments, un formulaire à saisir dans la console du fournisseur de Cloud</p>
    <p>Les manipulations sont à répéter <strong>autant de fois</strong> qu'il y a d'environnements de
        test ou de production</p>
    <blockquote class="fragment">➕ il y a d'opérations manuelles<br />➕ il y a de risques d'erreurs
    </blockquote>
</section>
<section>
    <h3>Et si on automatisait tout ça ?</h3>
    <img class="fragment no-border" src="images/logos/terraform.png" height="100px" />
    <ol>
        <li class="fragment">On décrit les ressources que l'on souhaite obtenir dans un format
            compréhensible par Terraform</li>
        <li class="fragment">Terraform va se connecter au fournisseur de Cloud souhaité (Amazon, Google,
            Microsoft...)</li>
        <li class="fragment">Terraform va comparer l'existant avec l'état souhaité et appliquer les
            changements</li>
    </ol>
</section>
<section>
    <h3>Et si on automatisait tout ça ?</h3>
    <img class="no-border" src="images/logos/terraform.png" height="100px" />
    <pre><code data-trim>resource "google_dns_record_set" "dns" {
project      = "les-sagas-mp3"
name         = "app.les-sagas-mp3.fr"
type         = "A"
ttl          = 300
rrdatas      = [34.163.30.76]
}</code></pre>
</section>
<section>
    <h3>La machine virtuelle est une coquille vide</h3>
    <p>Une fois créé, le serveur est vide. Il faut encore installer et configurer :</p>
    <ul>
        <li class="fragment">Une base de données PostgreSQL</li>
        <li class="fragment">Java</li>
        <li class="fragment">Un serveur web (Nginx en l'occurrence)</li>
        <li class="fragment">Nos composants API et App</li>
        <li class="fragment">L'exposition HTTPS</li>
    </ul>
</section>
<section>
    <h3>Et si on automatisait tout ça ?</h3>
    <img class="fragment no-border" src="images/logos/ansible.png" height="100px" />
    <ol>
        <li class="fragment">On décrit l'état que l'on souhaite donner au serveur dans un format
            compréhensible par Ansible</li>
        <li class="fragment">Ansible va se connecter à la machine créée par Terraform grace à son IP
            publique</li>
        <li class="fragment">Ansible va comparer l'existant avec l'état souhaité et appliquer les
            changements</li>
    </ol>
    <blockquote class="fragment">✅ C'est le même principe que Terraform</blockquote>
</section>
<section>
    <h3>Et si on automatisait tout ça ?</h3>
    <img class="no-border" src="images/logos/ansible.png" height="100px" />
    <pre><code data-trim>- name: Download Java binaries
get_url:
url: "https://download.java.net/java/GA/jdk19.0.1/afdd2e245b014143b62ccb916125e3ce/10/GPL/openjdk-19.0.1_linux-x64_bin.tar.gz"
dest: "/tmp/openjdk.tar.gz"
checksum: "7a466882c7adfa369319fe4adeb197ee5d7f79e75d641e9ef94abee1fc22b1fa"</code></pre>
</section>
<section>
    <h3>Et si on automatisait l'automatisation ?</h3>
    <div class="r-stack">
        <img class="fragment" src="images/gifs/mind-blow-galaxy.gif" height="300px" />
    </div>
</section>
<section>
    <h3>Oui, il en reste des choses à automatiser !</h3>
    <ul>
        <li class="fragment">Les commandes Terraform et Ansible exécutées la main depuis son poste...
        </li>
        <li class="fragment">pour chacun des environnements dont on a besoin ...</li>
        <li class="fragment">avec à chaque fois, la configuration à adapter au contexte...</li>
        <li class="fragment">et la source de nos composants API et APP qui proviennent toujours du poste
            de développement</li>
    </ul>
    <aside class="notes">
        <p>Le principal enjeu : permettre à des nouveaux développeurs d'intégrer facilement le projet.
        </p>
    </aside>
</section>